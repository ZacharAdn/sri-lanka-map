<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Sri Lanka Trip Map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }

#controls {
  position: fixed; top: 0; left: 0; right: 0; z-index: 1000;
  background: #fff; padding: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

#location-row {
  display: flex; align-items: center; gap: 8px; margin-bottom: 8px;
}

#location-select {
  flex: 1; padding: 8px 12px; font-size: 16px; border: 2px solid #ddd;
  border-radius: 8px; background: #fff; appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat; background-position: right 12px center;
}

#pin-count {
  font-size: 13px; color: #666; white-space: nowrap;
}

#filters {
  display: flex; gap: 6px; overflow-x: auto; padding-bottom: 4px;
  -webkit-overflow-scrolling: touch; scrollbar-width: none;
}
#filters::-webkit-scrollbar { display: none; }

.filter-btn {
  flex-shrink: 0; padding: 6px 14px; border: 2px solid; border-radius: 20px;
  font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.15s;
  display: flex; align-items: center; gap: 5px; white-space: nowrap;
}
.filter-btn .dot {
  width: 10px; height: 10px; border-radius: 50%; display: inline-block;
}
.filter-btn.active { color: #fff; }
.filter-btn:not(.active) { background: #fff; opacity: 0.5; }

#map { position: fixed; top: 0; left: 0; right: 0; bottom: 0; }

.leaflet-popup-content-wrapper {
  border-radius: 10px; font-size: 14px;
}
.leaflet-popup-content { margin: 10px 14px; line-height: 1.4; }
.popup-name { font-weight: 700; font-size: 15px; margin-bottom: 4px; }
.popup-cat { font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px; }
.popup-desc { color: #555; font-size: 13px; }
.nav-btn {
  display: inline-block; margin-top: 8px; padding: 6px 14px;
  background: #4285f4; color: #fff; border-radius: 6px;
  text-decoration: none; font-size: 13px; font-weight: 600;
}
</style>
</head>
<body>

<div id="controls">
  <div id="location-row">
    <select id="location-select"></select>
    <span id="pin-count"></span>
  </div>
  <div id="filters"></div>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const CATEGORIES = {
  accommodation: { label: 'Stay',      color: '#2d8a4e' },
  surf:          { label: 'Surf',      color: '#0077cc' },
  chabad:        { label: 'Chabad',    color: '#7b2d8e' },
  food:          { label: 'Food',      color: '#d63031' },
  cafe:          { label: 'Cafe',      color: '#e17055' },
  beach:         { label: 'Beach',     color: '#00b894' },
  shopping:      { label: 'Shopping',  color: '#fdcb6e' },
  services:      { label: 'Services',  color: '#636e72' },
  transport:     { label: 'Transport', color: '#6c5ce7' },
};

const DESTINATIONS = {
  "hikkaduwa": {
    "center": [
      6.133,
      80.103
    ],
    "zoom": 14,
    "data": {
      "accommodation": [
        {
          "name": "Home Away Guesthouse",
          "lat": 6.1389,
          "lng": 80.1027,
          "desc": "Feb 15-17. $17.50/night. Quiet jungle vibe, good kitchen. Amarasena Mawatha."
        }
      ],
      "surf": [
        {
          "name": "Owakanda Point",
          "lat": 6.0816,
          "lng": 80.1478,
          "desc": "#1 \u2014 mellow lefts, longboard, deep reef. 20 min tuk-tuk south."
        },
        {
          "name": "Narigama Beach (Surf)",
          "lat": 6.1219,
          "lng": 80.112,
          "desc": "Sand bottom, warmup sessions. Board rental on beach ~$11-15."
        },
        {
          "name": "North Jetty",
          "lat": 6.144,
          "lng": 80.097,
          "desc": "Left-dominant reef. Quality long lefts, intermediate+. Near harbour."
        }
      ],
      "beach": [
        {
          "name": "Coral Sanctuary / Hikkaduwa Reef",
          "lat": 6.1351,
          "lng": 80.0995,
          "desc": "Snorkeling spot. Glass-bottom boats, coral, sea turtles."
        }
      ],
      "chabad": [
        {
          "name": "Chabad Hikkaduwa",
          "lat": 6.1289,
          "lng": 80.1039,
          "desc": "397 Galle Rd. +94 76 883 3653. Status uncertain for 2026."
        }
      ],
      "food": [
        {
          "name": "Ranjith Cafe",
          "lat": 6.1229,
          "lng": 80.1129,
          "desc": "Local food, cheap rice & curry. Galle Rd, Thiranagama."
        },
        {
          "name": "No.1 Roti Restaurant",
          "lat": 6.1297,
          "lng": 80.1032,
          "desc": "Best roti in Hikkaduwa. 373 Galle-Colombo Rd."
        }
      ],
      "shopping": [
        {
          "name": "Cargills Food City Express",
          "lat": 6.1432,
          "lng": 80.0997,
          "desc": "162 Galle Rd. Main supermarket."
        }
      ],
      "services": [
        {
          "name": "Reef End Surf School",
          "lat": 6.125,
          "lng": 80.108,
          "desc": "Est. 2004, good wave matching. Narigama area."
        },
        {
          "name": "Hippie Surf School",
          "lat": 6.126,
          "lng": 80.1087,
          "desc": "1:1 intermediate coaching. Narigama."
        },
        {
          "name": "Owakanda Surf School",
          "lat": 6.0834,
          "lng": 80.1487,
          "desc": "At the point break. Longboard-focused. 567 Galle Rd, Rathgama."
        }
      ],
      "cafe": [],
      "transport": []
    }
  },
  "unawatuna": {
    "center": [
      6.015,
      80.245
    ],
    "zoom": 15,
    "data": {
      "accommodation": [
        {
          "name": "Sea & Greens Apartments (BOOKED)",
          "lat": 6.0238,
          "lng": 80.2464,
          "desc": "Feb 17-20. ~$26/night. 9.7/10. 260A Ranaviru Priyadarshana Mawatha."
        }
      ],
      "surf": [
        {
          "name": "Bonavista Beach (Surf Spot)",
          "lat": 6.0308,
          "lng": 80.24,
          "desc": "Reef break. Between Galle and Unawatuna, NW of main beach."
        },
        {
          "name": "Dewata Surf School",
          "lat": 6.0326,
          "lng": 80.2385,
          "desc": "Board rental & lessons. 472/B Matara Rd, near Bonavista."
        }
      ],
      "beach": [
        {
          "name": "Unawatuna Beach",
          "lat": 6.0097,
          "lng": 80.2484,
          "desc": "Main beach. Sheltered bay, calm, good swimming."
        },
        {
          "name": "Jungle Beach",
          "lat": 6.0173,
          "lng": 80.2375,
          "desc": "Small hidden beach. 15 min walk through forest from Unawatuna."
        }
      ],
      "food": [
        {
          "name": "Bedspace Kitchen",
          "lat": 6.0125,
          "lng": 80.2492,
          "desc": "Cafe with good food, popular with travelers."
        },
        {
          "name": "Lucky Tuna",
          "lat": 6.0098,
          "lng": 80.2482,
          "desc": "Seafood, grilled fish. Welle Dewalaya Road."
        },
        {
          "name": "Kingfisher Restaurant",
          "lat": 6.0086,
          "lng": 80.2442,
          "desc": "Sri Lankan & Western. Basigewatta Devala Rd, on the beach."
        },
        {
          "name": "Happy Banana",
          "lat": 6.0097,
          "lng": 80.2481,
          "desc": "Budget rice & curry, local favorite. Wallaye Deywala Road."
        },
        {
          "name": "Wijaya Beach Restaurant",
          "lat": 6.0001,
          "lng": 80.2633,
          "desc": "Beach restaurant, grilled seafood. Dalawella, further east."
        }
      ],
      "cafe": [
        {
          "name": "South Ceylon Bakery & Cafe",
          "lat": 6.0142,
          "lng": 80.2494,
          "desc": "Coffee, pastries, good WiFi. 94 Wella Dewalaya Rd."
        }
      ],
      "shopping": [
        {
          "name": "Cargills Food City Unawatuna",
          "lat": 6.0202,
          "lng": 80.2478,
          "desc": "Main supermarket. Near Unawatuna Junction on Matara Rd."
        },
        {
          "name": "Unawatuna Fruit & Veg Stalls",
          "lat": 6.02,
          "lng": 80.2478,
          "desc": "Roadside stalls along Matara Rd. Cheap fresh produce."
        }
      ],
      "services": [
        {
          "name": "eFix Galle (Mac Repair)",
          "lat": 6.0368,
          "lng": 80.2178,
          "desc": "75B Sri Hemanandha Mawatha, Bataganvila. 5.0/5. +94 77 061 2021."
        },
        {
          "name": "Galle Fort (UNESCO)",
          "lat": 6.0286,
          "lng": 80.2168,
          "desc": "Historic fort. Cafes, shops, sunset walk. 10 min tuk-tuk."
        },
        {
          "name": "Galle Train Station",
          "lat": 6.0346,
          "lng": 80.2141,
          "desc": "Main train station. Trains to Colombo, Matara, Weligama."
        }
      ],
      "transport": [
        {
          "name": "Unawatuna Junction (Bus)",
          "lat": 6.0202,
          "lng": 80.2478,
          "desc": "Bus stop on Matara Rd. Buses to Galle, Weligama, Matara."
        }
      ],
      "chabad": []
    }
  },
  "weligama": {
    "center": [
      5.973,
      80.429
    ],
    "zoom": 15,
    "data": {
      "accommodation": [
        {
          "name": "Sana Guest (BOOKED)",
          "lat": 5.9725,
          "lng": 80.4253,
          "desc": "Feb 20-22. $37/night. 4.9/5. Full kitchen, WiFi, balcony. 8-12 min walk to Chabad."
        }
      ],
      "surf": [
        {
          "name": "Weligama Bay (Longboard)",
          "lat": 5.9722,
          "lng": 80.4303,
          "desc": "Beginner paradise. Wide sandy bay, gentle waves. Cheapest board rental on coast."
        }
      ],
      "beach": [
        {
          "name": "Weligama Beach",
          "lat": 5.9719,
          "lng": 80.4312,
          "desc": "Main beach. Long sandy stretch, calm."
        },
        {
          "name": "Taprobane Island",
          "lat": 5.9678,
          "lng": 80.4256,
          "desc": "Iconic tiny island in the bay. Photo spot."
        }
      ],
      "chabad": [
        {
          "name": "Chabad Weligama + Kosher Restaurant",
          "lat": 5.9742,
          "lng": 80.4323,
          "desc": "17 Buhari Masjid Rd. Rabbi Yossi Romach. +94 74 360 0652. Only kosher restaurant on south coast."
        }
      ],
      "food": [
        {
          "name": "Weligama Fish Market",
          "lat": 5.9719,
          "lng": 80.4282,
          "desc": "Fresh catch. Go early morning. Bypass Beach Road."
        },
        {
          "name": "Alkimia / La Casa",
          "lat": 5.9742,
          "lng": 80.4326,
          "desc": "12 Buhari Masjid Rd. Spanish restaurant, next to Chabad."
        },
        {
          "name": "Sri Lankan Organic Food Center ★",
          "lat": 5.9735,
          "lng": 80.4305,
          "desc": "KOSHER-FRIENDLY: Fish + veg curries only (no meat/shellfish reported). Rice & curry buffet, takeaway. Cheap, women-run. +94 78 696 1700. Call to confirm."
        },
        {
          "name": "Welle Gedara (Fully Vegan)",
          "lat": 5.9649,
          "lng": 80.4214,
          "desc": "FULLY VEGAN: Sri Lankan rice & curry, jackfruit wraps. Kaparatota. 15 min walk from Sana Guest. +94 71 312 3148. Also cooking classes."
        }
      ],
      "cafe": [
        {
          "name": "Dreamy Surf House",
          "lat": 5.9742,
          "lng": 80.4326,
          "desc": "Galbokka Rd. Surf hostel with cafe/restaurant."
        },
        {
          "name": "Layback Rooftop Cafe ★",
          "lat": 5.9730,
          "lng": 80.4310,
          "desc": "Rooftop cafe + AC coworking. Healthy food, smoothies, acai bowls. +94 76 630 0126"
        },
        {
          "name": "NOMAD Cafe",
          "lat": 5.9741,
          "lng": 80.4378,
          "desc": "#1 nomad cafe. Plant-forward food, reliable WiFi, many sockets. 640 Matara Rd."
        },
        {
          "name": "Plan B Coworking",
          "lat": 5.9680,
          "lng": 80.4430,
          "desc": "Dedicated cowork + cafe. 1 Gbps fiber, backup generator. Bypass Rd."
        },
        {
          "name": "Hangten Rooftop",
          "lat": 5.9729,
          "lng": 80.4346,
          "desc": "Rooftop at Hangtime Hostel. Good coffee, social events. Budget-friendly."
        },
        {
          "name": "Ceylon Sliders",
          "lat": 5.9730,
          "lng": 80.4270,
          "desc": "Courtyard cafe near beach. Specialty coffee, bowls, ocean view."
        }
      ],
      "shopping": [
        {
          "name": "Cargills Food City Weligama",
          "lat": 5.9733,
          "lng": 80.4322,
          "desc": "454 Old Galle Road. Main supermarket."
        },
        {
          "name": "Global Food City",
          "lat": 5.9753,
          "lng": 80.4287,
          "desc": "111 Vajiragnana Mawatha."
        },
        {
          "name": "Sunday Market",
          "lat": 5.973,
          "lng": 80.427,
          "desc": "Best prices for fresh produce. Sunday only."
        }
      ],
      "services": [
        {
          "name": "Weligama Railway Station",
          "lat": 5.9757,
          "lng": 80.4295,
          "desc": "Coastal train line. Trains to Colombo, Galle, Matara."
        }
      ],
      "transport": [
        {
          "name": "Weligama Railway Station",
          "lat": 5.9757,
          "lng": 80.4295,
          "desc": "Coastal train. Colombo, Galle, Matara."
        },
        {
          "name": "Weligama Bus Stand",
          "lat": 5.9735,
          "lng": 80.4295,
          "desc": "Main bus station."
        }
      ]
    }
  },
  "hiriketiya": {
    "center": [
      5.963,
      80.705
    ],
    "zoom": 15,
    "data": {
      "accommodation": [
        {
          "name": "SurfBayVilla (BOOKED)",
          "lat": 5.9651,
          "lng": 80.6964,
          "desc": "Feb 24-27. $65/night. Dickwella. AC, WiFi (SURF1111), kitchen, garden. Host: Chamila 077-2260486."
        }
      ],
      "surf": [
        {
          "name": "Hiriketiya Bay \u2014 West (Beginner)",
          "lat": 5.962,
          "lng": 80.7065,
          "desc": "Beach break, sand bottom. Soft rolling waves. Board rental shacks here. Warmup spot."
        },
        {
          "name": "Hiriketiya Bay \u2014 Middle (Intermediate)",
          "lat": 5.9625,
          "lng": 80.7075,
          "desc": "A-frame peaks, left-breaking. Rock reef to sand. Your sweet spot \u2014 mellow lefts, 50m+ rides. Best at mid-tide."
        },
        {
          "name": "Hiriketiya Bay \u2014 East Reef (Advanced)",
          "lat": 5.963,
          "lng": 80.709,
          "desc": "Fast walling left over shallow reef. 150-350m rides. Experts only when big."
        },
        {
          "name": "Dickwella Beach (Surf)",
          "lat": 5.9668,
          "lng": 80.695,
          "desc": "Right-hand beach break, sand. Beginner-intermediate. Punchier than Hiri. 2 min from SurfBayVilla."
        },
        {
          "name": "Kudawella Beach",
          "lat": 5.9786,
          "lng": 80.7223,
          "desc": "Multiple peaks, sand. Long mellow waves, great for longboarding. 10 min tuk-tuk east."
        }
      ],
      "beach": [
        {
          "name": "Hiriketiya Beach",
          "lat": 5.9622,
          "lng": 80.7068,
          "desc": "Beautiful horseshoe bay. Swimming, surf, chill."
        },
        {
          "name": "Dickwella Beach",
          "lat": 5.9668,
          "lng": 80.6945,
          "desc": "Main Dickwella beach. Surf + swimming."
        }
      ],
      "chabad": [],
      "food": [
        {
          "name": "Garlic Cafe",
          "lat": 5.9663,
          "lng": 80.7071,
          "desc": "Curry buffet evenings. 500 LKR ($1.60). Cheapest meal in Hiri. Up Hiriketiya Rd."
        },
        {
          "name": "Duni's Hoppers Cafe",
          "lat": 5.963,
          "lng": 80.7059,
          "desc": "Veg rice & curry + dessert. 750 LKR ($2.50)."
        },
        {
          "name": "Lemon Grass Cafe",
          "lat": 5.965,
          "lng": 80.706,
          "desc": "Rice & curry, 4+ curries, unlimited refills, fruit dessert. 1,000 LKR ($3.30). On Hiriketiya Rd."
        },
        {
          "name": "Hiriketiya Seafood Restaurant",
          "lat": 5.9645,
          "lng": 80.7065,
          "desc": "Rice & curry buffet. 1,200 LKR ($4). Hiriketiya Rd."
        },
        {
          "name": "Raa Hiriketiya",
          "lat": 5.9615,
          "lng": 80.7099,
          "desc": "Oceanfront cocktail bar + dinner. High quality food. East side of bay."
        }
      ],
      "cafe": [
        {
          "name": "Mond",
          "lat": 5.9601,
          "lng": 80.7051,
          "desc": "#1 digital nomad spot. Cliff-side headland, ocean breeze. Best coffee in town. Strong WiFi."
        },
        {
          "name": "Dots Bay House",
          "lat": 5.963,
          "lng": 80.7077,
          "desc": "Restaurant + bar + 24/7 coworking. Desks & bean bags. Social hub of Hiri."
        },
        {
          "name": "Verse Collective",
          "lat": 5.9631,
          "lng": 80.6996,
          "desc": "Proper coworking. 100 Mbps WiFi. Indoor + outdoor desks. Pehebiya Rd, closer to Dickwella."
        }
      ],
      "shopping": [
        {
          "name": "Cargills Food City Dickwella",
          "lat": 5.9647,
          "lng": 80.6955,
          "desc": "52 Tangalle Rd. Main supermarket."
        }
      ],
      "services": [
        {
          "name": "Hiri Surf School",
          "lat": 5.9624,
          "lng": 80.707,
          "desc": "Board rental + lessons at the bay."
        }
      ],
      "transport": [
        {
          "name": "Dickwella Bus Stand",
          "lat": 5.966,
          "lng": 80.696,
          "desc": "Buses to Matara, Tangalle. Near Cargills."
        }
      ]
    }
  },
  "ahangama": {
    "center": [
      5.974,
      80.365
    ],
    "zoom": 14,
    "data": {
      "accommodation": [],
      "surf": [
        {
          "name": "The Rock (Kabalana)",
          "lat": 5.9766,
          "lng": 80.3475,
          "desc": "Iconic A-frame reef break. Left & right. Intermediate-advanced. Shallow reef \u2014 booties recommended."
        },
        {
          "name": "Kabalana Beach Break",
          "lat": 5.9776,
          "lng": 80.349,
          "desc": "Sand bottom, beginner-intermediate. Mellow waves next to The Rock. Board rental on beach."
        },
        {
          "name": "Sticks (Ahangama)",
          "lat": 5.9747,
          "lng": 80.3544,
          "desc": "Right-hand reef break near the stilt fishermen. Intermediate. Consistent swell magnet."
        },
        {
          "name": "South Beach / Plantation Point",
          "lat": 5.9818,
          "lng": 80.3367,
          "desc": "Long left point break. Advanced. Works on bigger swells. West of Kabalana."
        }
      ],
      "beach": [
        {
          "name": "Kabalana Beach",
          "lat": 5.9776,
          "lng": 80.349,
          "desc": "Beautiful long stretch. Surf + swimming. Stilt fishermen nearby."
        }
      ],
      "chabad": [],
      "food": [
        {
          "name": "Manori's Kitchen",
          "lat": 5.974,
          "lng": 80.362,
          "desc": "Local rice & curry, cheap and authentic. Ahangama village."
        }
      ],
      "cafe": [
        {
          "name": "Focus Hub Coworking & Cafe",
          "lat": 5.9716,
          "lng": 80.3655,
          "desc": "Coworking + cafe. Good WiFi, AC rooms. Ahangama main road."
        },
        {
          "name": "Cafe Ceylon",
          "lat": 5.9782,
          "lng": 80.3485,
          "desc": "Coffee + food near Kabalana. Popular with surfers."
        },
        {
          "name": "NETS Cowork",
          "lat": 5.9719,
          "lng": 80.3717,
          "desc": "Coworking space. High-speed WiFi, standing desks. East of Ahangama."
        },
        {
          "name": "Zippi Cafe",
          "lat": 5.9700,
          "lng": 80.3640,
          "desc": "Specialty coffee, matcha, focaccia sandwiches. Cowork-friendly."
        }
      ],
      "shopping": [
        {
          "name": "Cargills Food City Ahangama",
          "lat": 5.9725,
          "lng": 80.3638,
          "desc": "Main supermarket on Galle Road."
        }
      ],
      "services": [],
      "transport": [
        {
          "name": "Ahangama Railway Station",
          "lat": 5.9732,
          "lng": 80.3639,
          "desc": "Coastal train line. Trains to Galle, Colombo, Weligama, Matara."
        }
      ]
    }
  },
  "midigama": {
    "center": [
      5.962,
      80.393
    ],
    "zoom": 15,
    "data": {
      "accommodation": [],
      "surf": [
        {
          "name": "Lazy Left",
          "lat": 5.9629,
          "lng": 80.3907,
          "desc": "Long mellow left point break. Beginner-intermediate. Longboard paradise. Sand to reef."
        },
        {
          "name": "Rams Right",
          "lat": 5.9629,
          "lng": 80.394,
          "desc": "Powerful right reef break. Intermediate-advanced. South of Lazy Left."
        },
        {
          "name": "Plantations",
          "lat": 5.9601,
          "lng": 80.399,
          "desc": "Right-hand reef break. Intermediate. East of Midigama, consistent."
        }
      ],
      "beach": [
        {
          "name": "Midigama Beach",
          "lat": 5.9629,
          "lng": 80.391,
          "desc": "Small beach at Lazy Left. Surf-focused, rocky sections."
        }
      ],
      "chabad": [],
      "food": [
        {
          "name": "Wild Beach Cafe",
          "lat": 5.9656,
          "lng": 80.3911,
          "desc": "Beachfront cafe/restaurant. Good food, ocean views."
        }
      ],
      "cafe": [
        {
          "name": "Surfescape Midigama",
          "lat": 5.9650,
          "lng": 80.3910,
          "desc": "Beachfront cafe + cowork. Fiber WiFi, AC. Healthy food. $5-10/day pass."
        },
        {
          "name": "Ram's Surfing Beach Cafe",
          "lat": 5.9648,
          "lng": 80.3895,
          "desc": "Local beachfront cafe near Ram's break. Surfer crowd, simple food."
        }
      ],
      "shopping": [],
      "services": [
        {
          "name": "Surfing Wombats",
          "lat": 5.9664,
          "lng": 80.3918,
          "desc": "Surf school + board rental. Lessons for all levels."
        },
        {
          "name": "Cheeky Monkey Surf",
          "lat": 5.9621,
          "lng": 80.3964,
          "desc": "Surf school. Longboard coaching, board rental."
        }
      ],
      "transport": [
        {
          "name": "Midigama Railway Station",
          "lat": 5.9647,
          "lng": 80.393,
          "desc": "Small station on coastal line. Trains to Galle, Weligama."
        }
      ]
    }
  },
  "mirissa": {
    "center": [5.948, 80.468],
    "zoom": 15,
    "data": {
      "accommodation": [],
      "surf": [],
      "chabad": [],
      "food": [],
      "cafe": [
        {
          "name": "Capybara Cafe",
          "lat": 5.9480,
          "lng": 80.4710,
          "desc": "Garden cowork, 24/7 access, bean bags + desks, private rooms."
        },
        {
          "name": "Shady Lane",
          "lat": 5.9465,
          "lng": 80.4680,
          "desc": "Vegetarian cafe, nomad-friendly upstairs. WiFi pw: happybanana."
        }
      ],
      "beach": [
        {
          "name": "Mirissa Beach",
          "lat": 5.9455,
          "lng": 80.4710,
          "desc": "Main beach. Whale watching boats depart from harbour nearby."
        }
      ],
      "shopping": [],
      "services": [],
      "transport": []
    }
  }
};

const map = L.map('map', { zoomControl: false });
L.control.zoom({ position: 'bottomright' }).addTo(map);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap',
  maxZoom: 18
}).addTo(map);

// Auto-detect location by trip schedule
const SCHEDULE = [
  { from: '2026-02-12', to: '2026-02-15', loc: 'hikkaduwa' },
  { from: '2026-02-15', to: '2026-02-17', loc: 'hikkaduwa' },
  { from: '2026-02-17', to: '2026-02-20', loc: 'unawatuna' },
  { from: '2026-02-20', to: '2026-02-23', loc: 'weligama' },
  { from: '2026-02-23', to: '2026-02-26', loc: 'hiriketiya' },
  { from: '2026-02-26', to: '2026-02-28', loc: 'weligama' },
  { from: '2026-02-28', to: '2026-03-07', loc: 'midigama' },
  { from: '2026-03-07', to: '2026-03-12', loc: 'mirissa' },
];

function getLocationByDate() {
  const today = new Date().toISOString().slice(0, 10);
  for (const s of SCHEDULE) {
    if (today >= s.from && today < s.to && DESTINATIONS[s.loc]) return s.loc;
  }
  return Object.keys(DESTINATIONS)[0];
}

let currentLocation = getLocationByDate();
let activeCategories = new Set(Object.keys(CATEGORIES));
let markers = {};

const select = document.getElementById('location-select');
for (const loc of Object.keys(DESTINATIONS)) {
  const opt = document.createElement('option');
  opt.value = loc;
  opt.textContent = loc.charAt(0).toUpperCase() + loc.slice(1);
  select.appendChild(opt);
}
select.value = currentLocation;
select.addEventListener('change', () => {
  currentLocation = select.value;
  renderMap();
});

const filtersEl = document.getElementById('filters');
for (const [cat, info] of Object.entries(CATEGORIES)) {
  const btn = document.createElement('button');
  btn.className = 'filter-btn active';
  btn.dataset.category = cat;
  btn.style.borderColor = info.color;
  btn.style.backgroundColor = info.color;
  btn.innerHTML = `<span class="dot" style="background:${info.color}"></span>${info.label}`;
  btn.addEventListener('click', () => toggleCategory(cat, btn));
  filtersEl.appendChild(btn);
}

// "All" button to reset filters
const allBtn = document.createElement('button');
allBtn.className = 'filter-btn';
allBtn.style.borderColor = '#333';
allBtn.style.backgroundColor = '#fff';
allBtn.style.color = '#333';
allBtn.textContent = 'All';
allBtn.addEventListener('click', () => {
  activeCategories = new Set(Object.keys(CATEGORIES));
  document.querySelectorAll('.filter-btn[data-category]').forEach(b => {
    const c = b.dataset.category;
    b.classList.add('active');
    b.style.backgroundColor = CATEGORIES[c].color;
    b.style.color = '#fff';
  });
  updateMarkerVisibility();
  updatePinCount();
});
filtersEl.appendChild(allBtn);

function toggleCategory(cat, btn) {
  if (activeCategories.has(cat)) {
    activeCategories.delete(cat);
    btn.classList.remove('active');
    btn.style.backgroundColor = '#fff';
    btn.style.color = CATEGORIES[cat].color;
  } else {
    activeCategories.add(cat);
    btn.classList.add('active');
    btn.style.backgroundColor = CATEGORIES[cat].color;
    btn.style.color = '#fff';
  }
  updateMarkerVisibility();
  updatePinCount();
}

function createMarker(place, cat) {
  const color = CATEGORIES[cat].color;
  const marker = L.circleMarker([place.lat, place.lng], {
    radius: 10,
    fillColor: color,
    color: '#fff',
    weight: 2,
    opacity: 1,
    fillOpacity: 0.9
  });
  const navUrl = `https://www.google.com/maps/dir/?api=1&destination=${place.lat},${place.lng}`;
  marker.bindPopup(
    `<div class="popup-name">${place.name}</div>` +
    `<div class="popup-cat" style="color:${color}">${CATEGORIES[cat].label}</div>` +
    (place.desc ? `<div class="popup-desc">${place.desc}</div>` : '') +
    `<a class="nav-btn" href="${navUrl}" target="_blank">Navigate</a>`
  );
  return marker;
}

function renderMap() {
  for (const arr of Object.values(markers)) {
    arr.forEach(m => map.removeLayer(m));
  }
  markers = {};

  const dest = DESTINATIONS[currentLocation];
  map.setView(dest.center, dest.zoom);

  for (const [cat, places] of Object.entries(dest.data)) {
    markers[cat] = [];
    for (const place of places) {
      const m = createMarker(place, cat);
      markers[cat].push(m);
      if (activeCategories.has(cat)) {
        m.addTo(map);
      }
    }
  }
  updatePinCount();
}

function updateMarkerVisibility() {
  for (const [cat, arr] of Object.entries(markers)) {
    for (const m of arr) {
      if (activeCategories.has(cat)) {
        if (!map.hasLayer(m)) m.addTo(map);
      } else {
        map.removeLayer(m);
      }
    }
  }
}

function updatePinCount() {
  let visible = 0;
  let total = 0;
  const dest = DESTINATIONS[currentLocation];
  for (const [cat, places] of Object.entries(dest.data)) {
    total += places.length;
    if (activeCategories.has(cat)) visible += places.length;
  }
  document.getElementById('pin-count').textContent = visible === total
    ? `${total} pins`
    : `${visible}/${total} pins`;
}

function adjustMapPadding() {
  const h = document.getElementById('controls').offsetHeight;
  document.getElementById('map').style.top = h + 'px';
  map.invalidateSize();
}

window.addEventListener('resize', adjustMapPadding);
setTimeout(adjustMapPadding, 100);

renderMap();
</script>
</body>
</html>